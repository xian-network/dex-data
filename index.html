<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIAN DEX Chart</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-color: #1a1a1a;
            --text-color: #d4d4d4;
            --header-background: #1f1f1f;
            --header-text-color: #00ffff; /* For labels like 'Trading Pair:' in .selector-container */
            --primary-accent: #00ffff;
            --secondary-accent: #2a2a2a; /* Borders, grid lines */
            --chart-background: #1a1a1a;
            --chart-grid-color: #2a2a2a;
            --chart-text-color: #d4d4d4;
            --modal-background: #2a2a2a;
            --modal-text-color: #d4d4d4;
            --modal-border-color: #444;
            --modal-close-color: #aaa;
            --modal-close-hover-color: #00ffff;
            --input-background: #1a1a1a;
            --input-text-color: #d4d4d4;
            --input-border-color: #3a3a3a;
            --input-focus-border-color: #00ffff;
            --input-focus-shadow-color: rgba(0, 255, 255, 0.2);
            --button-background: #2a2a2a;
            --button-text-color: #00ffff;
            --button-hover-background: #3a3a3a;
            --button-hover-border-color: rgba(0, 255, 255, 0.5); /* #00ffff50 */
            --scrollbar-track: #1a1a1a;
            --scrollbar-thumb: #2a2a2a;
            --scrollbar-thumb-hover: #3a3a3a;
            --buy-color: #0066ff;
            --sell-color: #9933ff;
            --error-text-color: #ff0099;
            --error-border-color: rgba(255, 0, 153, 0.31); /* #ff009950 */
            --loader-text-color: #00ffff; /* Matches primary accent */
            --link-color: #00ffff; /* For future links if any, or for the signer address */
        }

        /* Theme Overrides */
        .theme-dark-default { /* This class will be on body */
            /* Variables are already defined in :root, this is for explicit association */
        }

        .theme-light {
            --background-color: #f4f4f4;
            --text-color: #333333;
            --header-background: #e9ecef;
            --header-text-color: #007bff;
            --primary-accent: #007bff;
            --secondary-accent: #ced4da;
            --chart-background: #ffffff;
            --chart-grid-color: #e0e0e0;
            --chart-text-color: #333333;
            --modal-background: #ffffff;
            --modal-text-color: #333333;
            --modal-border-color: #ced4da;
            --modal-close-color: #6c757d;
            --modal-close-hover-color: #0056b3;
            --input-background: #ffffff;
            --input-text-color: #495057;
            --input-border-color: #ced4da;
            --input-focus-border-color: #80bdff;
            --input-focus-shadow-color: rgba(0, 123, 255, 0.25);
            --button-background: #007bff;
            --button-text-color: #ffffff;
            --button-hover-background: #0056b3;
            --button-hover-border-color: rgba(0, 91, 179, 0.5);
            --scrollbar-track: #f0f0f0; /* Slightly different from body bg */
            --scrollbar-thumb: #ced4da;
            --scrollbar-thumb-hover: #adb5bd;
            --buy-color: #28a745;
            --sell-color: #dc3545;
            --error-text-color: #dc3545;
            --error-border-color: rgba(220, 53, 69, 0.31);
            --loader-text-color: #007bff;
            --link-color: #007bff;
        }

        .theme-ocean-blue {
            --background-color: #0f1c2e;
            --text-color: #e0f7fa;
            --header-background: #172a46;
            --header-text-color: #80deea;
            --primary-accent: #80deea;
            --secondary-accent: #264163;
            --chart-background: #122036;
            --chart-grid-color: #264163;
            --chart-text-color: #e0f7fa;
            --modal-background: #172a46;
            --modal-text-color: #e0f7fa;
            --modal-border-color: #264163;
            --modal-close-color: #b0bec5;
            --modal-close-hover-color: #80deea;
            --input-background: #122036;
            --input-text-color: #e0f7fa;
            --input-border-color: #264163;
            --input-focus-border-color: #80deea;
            --input-focus-shadow-color: rgba(128, 222, 234, 0.25);
            --button-background: #0077c2;
            --button-text-color: #ffffff;
            --button-hover-background: #005082;
            --button-hover-border-color: rgba(128, 222, 234, 0.5);
            --scrollbar-track: #0f1c2e;
            --scrollbar-thumb: #264163;
            --scrollbar-thumb-hover: #375a80;
            --buy-color: #4dd0e1;
            --sell-color: #ff7043;
            --error-text-color: #ff5252;
            --error-border-color: rgba(255, 82, 82, 0.3);
            --loader-text-color: #80deea;
            --link-color: #80deea;
        }

        .theme-forest-green {
            --background-color: #1a2e24;
            --text-color: #e8f5e9;
            --header-background: #253f32;
            --header-text-color: #a5d6a7;
            --primary-accent: #a5d6a7;
            --secondary-accent: #385946;
            --chart-background: #1e362a;
            --chart-grid-color: #385946;
            --chart-text-color: #e8f5e9;
            --modal-background: #253f32;
            --modal-text-color: #e8f5e9;
            --modal-border-color: #385946;
            --modal-close-color: #c8e6c9;
            --modal-close-hover-color: #a5d6a7;
            --input-background: #1e362a;
            --input-text-color: #e8f5e9;
            --input-border-color: #385946;
            --input-focus-border-color: #a5d6a7;
            --input-focus-shadow-color: rgba(165, 214, 167, 0.25);
            --button-background: #4caf50;
            --button-text-color: #ffffff;
            --button-hover-background: #388e3c;
            --button-hover-border-color: rgba(165, 214, 167, 0.5);
            --scrollbar-track: #1a2e24;
            --scrollbar-thumb: #385946;
            --scrollbar-thumb-hover: #4a745c;
            --buy-color: #66bb6a;
            --sell-color: #ef5350;
            --error-text-color: #f44336;
            --error-border-color: rgba(244, 67, 54, 0.3);
            --loader-text-color: #a5d6a7;
            --link-color: #a5d6a7;
        }

        .theme-royal-purple {
            --background-color: #2a1a3e;
            --text-color: #f3e5f5;
            --header-background: #392550;
            --header-text-color: #ce93d8;
            --primary-accent: #ce93d8;
            --secondary-accent: #4e3468;
            --chart-background: #301f48;
            --chart-grid-color: #4e3468;
            --chart-text-color: #f3e5f5;
            --modal-background: #392550;
            --modal-text-color: #f3e5f5;
            --modal-border-color: #4e3468;
            --modal-close-color: #e1bee7;
            --modal-close-hover-color: #ce93d8;
            --input-background: #301f48;
            --input-text-color: #f3e5f5;
            --input-border-color: #4e3468;
            --input-focus-border-color: #ce93d8;
            --input-focus-shadow-color: rgba(206, 147, 216, 0.25);
            --button-background: #8e44ad;
            --button-text-color: #ffffff;
            --button-hover-background: #6a1b9a;
            --button-hover-border-color: rgba(206, 147, 216, 0.5);
            --scrollbar-track: #2a1a3e;
            --scrollbar-thumb: #4e3468;
            --scrollbar-thumb-hover: #624380;
            --buy-color: #ba68c8;
            --sell-color: #f06292;
            --error-text-color: #ec407a;
            --error-border-color: rgba(236, 64, 122, 0.3);
            --loader-text-color: #ce93d8;
            --link-color: #ce93d8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #chart-container {
            flex: 1;
            position: relative;
            width: 100%;
            height: calc(70vh - 120px);
            background-color: var(--chart-background);
            border-bottom: 1px solid var(--secondary-accent);
        }

        #trade-history {
            height: 30vh;
            overflow-y: auto;
            background-color: var(--background-color);
            padding: 20px;
        }

        .trade-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .trade-history-table th {
            background-color: var(--secondary-accent); /* Table header distinct from main bg */
            color: var(--header-text-color); /* Use header text color for TH text */
            padding: 12px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .trade-history-table td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--secondary-accent);
        }

        .trade-history-table tr:hover {
            background-color: var(--secondary-accent); /* Use secondary for hover */
        }

        .buy-row td {
            color: var(--buy-color);
        }

        .sell-row td {
            color: var(--sell-color);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }

        /* Loading and error states */
        #loading, #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 8px;
            background-color: var(--modal-background); /* Use modal bg for loader/error box */
            border: 1px solid var(--modal-border-color); /* Use modal border */
            color: var(--loader-text-color); /* Specific loader text color */
            font-size: 14px;
            display: none;
        }

        #error {
            color: var(--error-text-color);
            border-color: var(--error-border-color);
        }

        /* Select dropdowns hover and focus states */
        select:hover { /* Applies to #theme-select and .pair-select, .timeframe-select */
            border-color: var(--input-focus-border-color) !important; /* Use focus border color for hover */
        }

        select:focus {
            outline: none;
            border-color: var(--input-focus-border-color) !important;
            box-shadow: 0 0 0 2px var(--input-focus-shadow-color);
        }

        /* Toggle button styling */
        .toggle-button { /* This class is dynamically added in chart.js */
            background-color: var(--button-background) !important;
            color: var(--button-text-color) !important;
            border: 1px solid var(--input-border-color) !important; /* Consistent border like inputs */
            transition: all 0.3s ease !important;
        }

        .toggle-button:hover {
            background-color: var(--button-hover-background) !important;
            border-color: var(--button-hover-border-color) !important;
        }

        #header-bar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
            padding: 10px;
            background-color: var(--header-background);
            border-bottom: 1px solid var(--secondary-accent);
            gap: 20px;
        }

        .header-icon { /* For the settings gear icon */
            font-size: 24px;
            color: var(--text-color);
            cursor: pointer;
            margin-left: auto;
            padding: 5px;
            display: flex;
            align-items: center;
        }

        .header-icon:hover {
            color: var(--primary-accent);
        }

        /* Settings Modal Styles */
        #settings-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Backdrop for modal */
        }

        .modal-content {
            background-color: var(--modal-background);
            color: var(--modal-text-color);
            margin: 10% auto;
            padding: 25px;
            border: 1px solid var(--modal-border-color);
            width: 80%;
            max-width: 450px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close-button {
            color: var(--modal-close-color);
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--modal-close-hover-color);
            text-decoration: none;
            cursor: pointer;
        }

        #theme-selector-container {
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #theme-selector-container label {
            font-weight: 500;
            color: var(--modal-text-color); /* Ensure label uses modal text color */
        }

        #theme-select { /* The dropdown in the modal */
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--input-border-color);
            background-color: var(--input-background);
            color: var(--input-text-color);
            font-family: 'Inter', sans-serif;
            flex-grow: 1;
        }
        /* End Settings Modal Styles */

        /* Adjustments for the containers within the header bar if needed */
        /* The .selector-container (created by JS) holds pair and timeframe selectors */
        .selector-container {
            /* Existing JS styles: backgroundColor, padding, borderRadius, display, gap, alignItems */
            /* Override specific ones if needed, or ensure JS uses CSS variables */
            background-color: var(--header-background) !important; /* Match header */
            padding: 8px !important; /* JS sets padding */
            border-radius: 4px !important; /* JS sets border-radius */
        }
        .selector-container label { /* Labels like "Trading Pair:", "Timeframe:" */
            color: var(--header-text-color) !important; /* Use header text color for these labels */
            font-weight: 500 !important;
        }
        .pair-select, .timeframe-select { /* Classes for selects created by JS */
            padding: 8px 12px !important; /* JS sets padding */
            border-radius: 4px !important; /* JS sets border-radius */
            border: 1px solid var(--input-border-color) !important; /* Use themeable border */
            background-color: var(--input-background) !important; /* Use themeable background */
            color: var(--input-text-color) !important; /* Use themeable text color */
            min-width: 150px; /* Adjusted min-width */
        }


        /* Style the toggle button to fit the dark theme */
        /* Styles for .toggle-button are already present and seem mostly compatible.
           We'll ensure padding, border-radius, and cursor are explicitly defined here
           if not already covered or if needing override without !important for these specific properties.
           The background, color, and border are already using !important from existing rules.
        */
        .toggle-button { /* This is also for the Invert Pair button */
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            /* background-color, color, border are already using !important with var() above */
            /* transition: background-color 0.3s ease, border-color 0.3s ease; */ /* Already defined */
        }

        /* .toggle-button:hover is already defined above using vars */

        /* Trades Footer Styling */
        #trades-footer {
            display: none; /* Hidden by default */
        }

        @media (max-width: 768px) {
            #trade-history {
                display: none !important; /* Ensure it's hidden */
            }

            #chart-container {
                height: calc(100vh - 88px) !important; /* 44px header + 44px footer */
                margin-bottom: 44px;
                border-bottom: none; /* Remove bottom border since trades pane is hidden */
            }

            #trades-footer {
                display: flex;
                background-color: var(--header-background);
                color: var(--primary-accent);
                padding: 12px 20px;
                text-align: center;
                border-top: 1px solid var(--secondary-accent);
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                z-index: 100;
                cursor: pointer;
                height: 44px;
                justify-content: center;
                align-items: center;
                gap: 8px;
            }

            #trades-footer .chevron-up {
                font-size: 1.2em;
            }

            /* Update chart container to account for footer */
            #chart-container {
                height: calc(100vh - 104px); /* Account for header (60px) and footer (44px) */
                margin-bottom: 44px; /* Height of the trades footer */
            }

            /* Ensure the modal doesn't get hidden behind the footer */
            #trades-modal {
                height: calc(100% - 44px); /* Full height minus footer */
                bottom: 44px; /* Position above footer */
            }

            #modal-trades-content {
                height: calc(100% - 60px); /* Subtract header height */
                padding-bottom: 44px; /* Add padding to account for footer */
            }
        }

        /* Trades Modal Styling */
        #trades-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            z-index: 1000;
            animation: slideUp 0.3s ease-out forwards;
            overflow-y: hidden;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        #trades-modal.hidden { /* Class to apply for slide down animation */
            animation: slideDown 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(100%);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--header-background);
            border-bottom: 1px solid var(--secondary-accent);
            color: var(--primary-accent);
        }

        .modal-header h2 {
            font-size: 1.2em;
            margin: 0;
            color: var(--primary-accent);
        }

        #modal-close-button {
            background: none;
            border: none;
            color: var(--primary-accent);
            font-size: 1.8em;
            cursor: pointer;
            padding: 0 5px;
        }

        #modal-close-button:hover {
            color: var(--modal-close-hover-color);
        }

        #modal-trades-content {
            height: calc(100% - 60px);
            overflow-y: auto;
            padding: 10px;
            color: var(--text-color);
            background-color: var(--background-color);
        }

        #modal-trades-content .trade-entry {
            padding: 8px;
            border-bottom: 1px solid var(--secondary-accent);
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        #modal-trades-content .trade-entry:hover {
            background-color: var(--secondary-accent);
        }

        #modal-trades-content .trade-entry:active {
            opacity: 0.8;
        }

        /* Add a subtle indicator that the item is clickable */
        #modal-trades-content .trade-entry::after {
            content: '→';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-accent);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        #modal-trades-content .trade-entry:hover::after {
            opacity: 0.5;
        }

        #modal-trades-content .trade-entry .trade-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        #modal-trades-content .trade-entry .trade-meta {
            font-size: 0.85em;
            color: var(--text-color);
            opacity: 0.7;
        }

        #modal-trades-content .buy { 
            color: var(--buy-color); 
        }

        #modal-trades-content .sell { 
            color: var(--sell-color); 
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #header-bar {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                padding: 4px 8px; /* Reduce padding */
                gap: 4px; /* Reduce gap between items */
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
                height: 44px; /* Fixed height for header */
            }

            .selector-container {
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                width: auto !important;
                min-width: min-content;
                padding: 4px !important; /* Reduce padding */
                gap: 4px !important; /* Reduce gap */
            }

            /* Hide labels on mobile */
            .selector-container label {
                display: none !important;
            }

            /* Optimize select elements */
            .pair-select {
                width: auto !important;
                min-width: 100px !important; /* Reduce minimum width */
                padding: 4px 6px !important; /* Reduce padding */
                font-size: 13px !important; /* Slightly smaller font */
            }

            .timeframe-select {
                width: 60px !important; /* Reduce width */
                padding: 4px 4px !important; /* Reduce padding */
                font-size: 13px !important; /* Slightly smaller font */
            }

            /* Adjust settings icon */
            .header-icon {
                font-size: 20px; /* Slightly smaller */
                padding: 4px;
                margin-left: 4px;
            }

            /* Adjust toggle button */
            .toggle-button {
                padding: 4px 8px !important;
                font-size: 13px !important;
            }

            /* Update chart container height to account for smaller header */
            #chart-container {
                height: calc(100vh - 88px); /* 44px header + 44px footer */
                margin-bottom: 44px;
            }
        }

        /* Add smooth scrolling for the header */
        .selector-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .selector-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        /* Add this to your CSS */
        .trade-signer a {
            color: var(--link-color);
            text-decoration: none;
        }

        .trade-signer a:hover {
            text-decoration: underline;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="header-bar">
        <span id="settings-gear-icon" class="header-icon">&#9881;</span>
    </div>
    <div id="chart-container">
        <div id="loading">Loading...</div>
        <div id="error"></div>
    </div>
    <div id="trade-history">
        <table class="trade-history-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Amount</th>
                    <th>Value</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody id="trade-history-body">
            </tbody>
        </table>
    </div>
    <div id="trades-footer">
        <span>Trades</span>
        <span class="chevron-up">&#9650;</span> <!-- Unicode for UP-POINTING TRIANGLE -->
    </div>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <script src="chart.js"></script>

    <!-- Settings Modal -->
    <div id="settings-modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Settings</h2>
            <div id="theme-selector-container">
                <label for="theme-select">Theme:</label>
                <select id="theme-select">
                    <option value="theme-dark-default">Dark Default</option>
                    <option value="theme-light">Light Mode</option>
                    <option value="theme-ocean-blue">Ocean Blue</option>
                    <option value="theme-forest-green">Forest Green</option>
                    <option value="theme-royal-purple">Royal Purple</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Trades Modal -->
    <div id="trades-modal">
        <div class="modal-header">
            <h2>All Trades</h2>
            <button id="modal-close-button">&times;</button>
        </div>
        <div id="modal-trades-content">
            <!-- Trades will be populated here by JavaScript -->
        </div>
    </div>
</body>
</html> 