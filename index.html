<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIAN DEX Chart</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            color: #d4d4d4;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #chart-container {
            flex: 1;
            position: relative;
            width: 100%;
            height: calc(70vh - 120px);
            background-color: #1a1a1a;
            border-bottom: 1px solid #2a2a2a;
        }

        #trade-history {
            height: 30vh;
            overflow-y: auto;
            background-color: #1a1a1a;
            padding: 20px;
        }

        .trade-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .trade-history-table th {
            background-color: #2a2a2a;
            color: #00ffff;
            padding: 12px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .trade-history-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #2a2a2a;
        }

        .trade-history-table tr:hover {
            background-color: #2a2a2a;
        }

        .buy-row td {
            color: #0066ff;
        }

        .sell-row td {
            color: #9933ff;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #2a2a2a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a3a3a;
        }

        /* Loading and error states */
        #loading, #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 8px;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #00ffff;
            font-size: 14px;
            display: none;
        }

        #error {
            color: #ff0099;
            border-color: #ff009950;
        }

        /* Select dropdowns hover and focus states */
        select:hover {
            border-color: #00ffff50 !important;
        }

        select:focus {
            outline: none;
            border-color: #00ffff !important;
            box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
        }

        /* Toggle button styling */
        .toggle-button {
            background-color: #2a2a2a !important;
            color: #00ffff !important;
            border: 1px solid #3a3a3a !important;
            transition: all 0.3s ease !important;
        }

        .toggle-button:hover {
            background-color: #3a3a3a !important;
            border-color: #00ffff50 !important;
        }

        #header-bar {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            align-items: center; /* Vertically align items */
            justify-content: flex-start; /* Align items to the start */
            padding: 10px;
            background-color: #1f1f1f; /* Slightly different from chart bg for distinction */
            border-bottom: 1px solid #2a2a2a;
            gap: 20px; /* Gap between direct children (selector-container and toggle-container) */
        }

        /* Adjustments for the containers within the header bar if needed */
        /* The .selector-container already has flex styles from JS, ensure they don't conflict */
        /* We might remove background and padding from .selector-container if header-bar provides it */
        .selector-container {
            /* background-color: transparent !important; /* Override JS style */
            /* padding: 0 !important; */ /* Override JS style */
            /* box-shadow: none !important; */ /* Override JS style */
            /* These overrides might be needed if JS styles are too specific */
        }

        /* Style the toggle button to fit the dark theme */
        /* Styles for .toggle-button are already present and seem mostly compatible.
           We'll ensure padding, border-radius, and cursor are explicitly defined here
           if not already covered or if needing override without !important for these specific properties.
           The background, color, and border are already using !important from existing rules.
        */
        .toggle-button {
            border-radius: 4px; /* Ensure border-radius */
            padding: 8px 12px; /* Ensure padding */
            cursor: pointer; /* Ensure cursor */
            /* background-color, color, border, transition are already defined with !important */
            /* transition: background-color 0.3s ease, border-color 0.3s ease; */ /* Already defined */
        }

        .toggle-button:hover {
            /* background-color and border-color hover effects are already defined with !important */
        }

        /* Trades Footer Styling */
        #trades-footer {
            display: none; /* Hidden by default, shown on mobile */
            background-color: #1f1f1f; /* Consistent with header-bar */
            color: #00ffff;
            padding: 12px 20px;
            text-align: center;
            border-top: 1px solid #2a2a2a;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100; /* Ensure it's above other content but below modal */
            cursor: pointer;
            display: flex; /* For aligning text and icon */
            justify-content: center;
            align-items: center;
            gap: 8px; /* Space between "Trades" and chevron */
        }

        #trades-footer .chevron-up {
            font-size: 1.2em; /* Make chevron slightly larger */
        }

        /* Trades Modal Styling */
        #trades-modal {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 26, 26, 0.95); /* Semi-transparent dark background */
            z-index: 1000; /* Ensure it's on top of everything */
            animation: slideUp 0.3s ease-out forwards;
            overflow-y: hidden; /* Prevent body scroll when modal is open, modal content will scroll */
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        #trades-modal.hidden { /* Class to apply for slide down animation */
            animation: slideDown 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(100%);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #1f1f1f;
            border-bottom: 1px solid #2a2a2a;
            color: #00ffff;
        }

        .modal-header h2 {
            font-size: 1.2em;
            margin: 0;
        }

        #modal-close-button {
            background: none;
            border: none;
            color: #00ffff;
            font-size: 1.8em;
            cursor: pointer;
            padding: 0 5px;
        }

        #modal-trades-content {
            height: calc(100% - 60px); /* Adjust based on modal-header height */
            overflow-y: auto;
            padding: 10px;
            color: #d4d4d4; /* Default text color for modal content */
        }

        /* Styling for trades within the modal (example, can be refined) */
        #modal-trades-content .trade-entry {
            padding: 8px;
            border-bottom: 1px solid #2a2a2a;
            font-size: 14px;
        }
        #modal-trades-content .trade-entry:last-child {
            border-bottom: none;
        }
        #modal-trades-content .trade-entry .trade-details {
            display: flex;
            justify-content: space-between;
        }
        #modal-trades-content .trade-entry .trade-meta {
            font-size: 0.85em;
            color: #888;
        }
        #modal-trades-content .buy { color: #0066ff; }
        #modal-trades-content .sell { color: #9933ff; }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #header-bar {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                padding: 8px;
                gap: 8px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            #header-bar::-webkit-scrollbar {
                display: none;
            }

            .selector-container {
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                width: auto !important;
                min-width: min-content;
            }

            /* Hide labels on mobile */
            .selector-container label {
                display: none !important;
            }

            .pair-select {
                width: auto !important;
                min-width: 120px !important;
            }

            .timeframe-select {
                width: 70px !important;
            }

            .toggle-container {
                width: auto !important;
            }

            .toggle-button {
                width: auto !important;
                flex-grow: 0 !important;
            }

            #trade-history {
                display: none;
            }

            #trades-footer {
                display: flex;
                height: 44px; /* Explicit height for footer */
            }

            #chart-container {
                height: calc(100vh - 60px); /* Account for header and footer */
                margin-bottom: 44px; /* Height of the trades footer */
            }

            /* Ensure the modal doesn't get hidden behind the footer */
            #trades-modal {
                padding-bottom: 44px;
            }
        }
    </style>
</head>
<body>
    <div id="header-bar"></div>
    <div id="chart-container">
        <div id="loading">Loading...</div>
        <div id="error"></div>
    </div>
    <div id="trade-history">
        <table class="trade-history-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Amount</th>
                    <th>Value</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody id="trade-history-body">
            </tbody>
        </table>
    </div>
    <div id="trades-footer">
        <span>Trades</span>
        <span class="chevron-up">&#9650;</span> <!-- Unicode for UP-POINTING TRIANGLE -->
    </div>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <script src="chart.js"></script>
    <div id="trades-modal">
        <div class="modal-header">
            <h2>All Trades</h2>
            <button id="modal-close-button">&times;</button> <!-- Unicode for multiplication sign (close) -->
        </div>
        <div id="modal-trades-content">
            <!-- Trades will be populated here by JavaScript -->
        </div>
    </div>
</body>
</html> 